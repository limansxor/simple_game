<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ë¬¼ 3ë§¤ì¹­ ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        @keyframes pulse {
            50% {
                opacity: .5;
            }
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(-25%);
                animation-timing-function: cubic-bezier(0.8,0,1,1);
            }
            50% {
                transform: translateY(0);
                animation-timing-function: cubic-bezier(0,0,0.2,1);
            }
        }
        .animate-ping {
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        .tile {
            transition: all 0.2s ease;
        }
        .tile:hover {
            transform: scale(1.05);
        }
        .tile.selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 2px #3b82f6;
        }
        .tile.matched {
            animation: pulse 2s infinite;
        }
        .tile.animating {
            animation: bounce 1s infinite;
        }
        .effect-span {
            transition: all 0.5s ease;
        }
        .effect-span.matched {
            transform: scale(1.5) rotate(180deg);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="flex flex-col items-center justify-center p-2 sm:p-4 lg:p-6 bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen">
        <div class="bg-white rounded-lg shadow-lg p-3 sm:p-4 lg:p-6 w-full max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg xl:max-w-xl">
            <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-center mb-2 sm:mb-4 text-purple-800">
                ğŸ® ë™ë¬¼ ë§¤ì¹­ ê²Œì„
            </h1>
            
            <div class="flex justify-between items-center mb-2 sm:mb-4">
                <div class="text-lg sm:text-xl font-semibold text-blue-600" id="score">
                    ì ìˆ˜: 0
                </div>
                <button
                    onclick="resetGame()"
                    class="px-3 py-1 sm:px-4 sm:py-2 text-sm sm:text-base bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                >
                    ìƒˆ ê²Œì„
                </button>
            </div>
            
            <div class="grid grid-cols-8 gap-0.5 sm:gap-1 bg-gray-300 p-1 sm:p-2 rounded-lg mx-auto" 
                 id="game-board" style="width: min(100%, 90vw, 500px); aspect-ratio: 1;">
            </div>
            
            <div class="mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-600 px-2">
                <p>ğŸ’¡ ì¸ì ‘í•œ ë‘ ë™ë¬¼ì„ í´ë¦­í•˜ì—¬ êµí™˜í•˜ì„¸ìš”!</p>
                <p class="hidden sm:block">ê°™ì€ ë™ë¬¼ 3ê°œ ì´ìƒì„ ì—°ê²°í•˜ë©´ ì ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>
                <p class="sm:hidden">ê°™ì€ ë™ë¬¼ 3ê°œ ì´ìƒ ì—°ê²°ë¡œ ì ìˆ˜ íšë“!</p>
            </div>
        </div>
    </div>

    <script>
        const animals = ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼'];
        const BOARD_SIZE = 8;
        const COLORS = {
            'ğŸ¶': 'bg-yellow-200',
            'ğŸ±': 'bg-orange-200', 
            'ğŸ­': 'bg-gray-200',
            'ğŸ¹': 'bg-pink-200',
            'ğŸ°': 'bg-green-200',
            'ğŸ¦Š': 'bg-red-200',
            'ğŸ»': 'bg-amber-200',
            'ğŸ¼': 'bg-slate-200'
        };

        let board = [];
        let selectedTiles = [];
        let score = 0;
        let isSwapping = false;
        let matchedTiles = [];
        let animatingTiles = [];

        // ë³´ë“œ ì´ˆê¸°í™”
        function initializeBoard() {
            board = [];
            for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {
                board.push(animals[Math.floor(Math.random() * animals.length)]);
            }
            renderBoard();
        }

        // ë³´ë“œ ë Œë”ë§
        function renderBoard() {
            const gameBoard = document.getElementById('game-board');
            gameBoard.innerHTML = '';
            
            board.forEach((animal, index) => {
                const tile = document.createElement('div');
                tile.className = `
                    tile aspect-square flex items-center justify-center cursor-pointer
                    rounded relative overflow-hidden
                    text-xs sm:text-sm md:text-base lg:text-lg
                    ${COLORS[animal] || 'bg-white'}
                    ${selectedTiles.includes(index) ? 'selected' : ''}
                    ${matchedTiles.includes(index) ? 'matched' : ''}
                    ${animatingTiles.includes(index) ? 'animating' : ''}
                `;
                
                if (isSwapping) {
                    tile.style.pointerEvents = 'none';
                }
                
                const span = document.createElement('span');
                span.className = `effect-span ${matchedTiles.includes(index) ? 'matched' : ''}`;
                span.textContent = animal;
                tile.appendChild(span);
                
                // ë§¤ì¹˜ íš¨ê³¼ ì¶”ê°€
                if (matchedTiles.includes(index)) {
                    // ë°˜ì§ì´ëŠ” íš¨ê³¼
                    const sparkle = document.createElement('div');
                    sparkle.className = 'absolute inset-0 bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400 opacity-75 animate-ping';
                    tile.appendChild(sparkle);
                    
                    // í­ë°œ íš¨ê³¼
                    const explosion = document.createElement('div');
                    explosion.className = 'absolute inset-0 flex items-center justify-center';
                    explosion.innerHTML = `
                        <div class="w-1 h-1 sm:w-2 sm:h-2 bg-yellow-400 rounded-full animate-ping"></div>
                        <div class="w-0.5 h-0.5 sm:w-1 sm:h-1 bg-white rounded-full animate-ping absolute top-0.5 sm:top-1 left-0.5 sm:left-1"></div>
                        <div class="w-0.5 h-0.5 sm:w-1 sm:h-1 bg-white rounded-full animate-ping absolute top-0.5 sm:top-1 right-0.5 sm:right-1"></div>
                        <div class="w-0.5 h-0.5 sm:w-1 sm:h-1 bg-white rounded-full animate-ping absolute bottom-0.5 sm:bottom-1 left-0.5 sm:left-1"></div>
                        <div class="w-0.5 h-0.5 sm:w-1 sm:h-1 bg-white rounded-full animate-ping absolute bottom-0.5 sm:bottom-1 right-0.5 sm:right-1"></div>
                    `;
                    tile.appendChild(explosion);
                    
                    // ì ìˆ˜ í‘œì‹œ
                    const scorePopup = document.createElement('div');
                    scorePopup.className = 'absolute -top-4 sm:-top-6 left-1/2 transform -translate-x-1/2 text-yellow-500 font-bold text-xs animate-bounce';
                    scorePopup.textContent = '+10';
                    tile.appendChild(scorePopup);
                }
                
                tile.addEventListener('click', () => handleTileClick(index));
                gameBoard.appendChild(tile);
            });
        }

        // ë§¤ì¹˜ ì°¾ê¸°
        function findMatches() {
            const matches = new Set();
            
            // ê°€ë¡œ ë§¤ì¹˜ ì°¾ê¸°
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE - 2; col++) {
                    const index = row * BOARD_SIZE + col;
                    const animal = board[index];
                    if (animal && 
                        board[index + 1] === animal && 
                        board[index + 2] === animal) {
                        matches.add(index);
                        matches.add(index + 1);
                        matches.add(index + 2);
                        
                        // ì—°ì†ëœ ë§¤ì¹˜ í™•ì¥
                        let extendCol = col + 3;
                        while (extendCol < BOARD_SIZE && board[row * BOARD_SIZE + extendCol] === animal) {
                            matches.add(row * BOARD_SIZE + extendCol);
                            extendCol++;
                        }
                    }
                }
            }
            
            // ì„¸ë¡œ ë§¤ì¹˜ ì°¾ê¸°
            for (let col = 0; col < BOARD_SIZE; col++) {
                for (let row = 0; row < BOARD_SIZE - 2; row++) {
                    const index = row * BOARD_SIZE + col;
                    const animal = board[index];
                    if (animal && 
                        board[index + BOARD_SIZE] === animal && 
                        board[index + BOARD_SIZE * 2] === animal) {
                        matches.add(index);
                        matches.add(index + BOARD_SIZE);
                        matches.add(index + BOARD_SIZE * 2);
                        
                        // ì—°ì†ëœ ë§¤ì¹˜ í™•ì¥
                        let extendRow = row + 3;
                        while (extendRow < BOARD_SIZE && board[extendRow * BOARD_SIZE + col] === animal) {
                            matches.add(extendRow * BOARD_SIZE + col);
                            extendRow++;
                        }
                    }
                }
            }
            
            return Array.from(matches);
        }

        // íƒ€ì¼ ë–¨ì–´ëœ¨ë¦¬ê¸°
        function dropTiles(matchedIndices) {
            const newBoard = [...board];
            
            // ë§¤ì¹˜ëœ íƒ€ì¼ ì œê±°
            matchedIndices.forEach(index => {
                newBoard[index] = null;
            });
            
            // ê° ì—´ì— ëŒ€í•´ íƒ€ì¼ ë–¨ì–´ëœ¨ë¦¬ê¸°
            for (let col = 0; col < BOARD_SIZE; col++) {
                const column = [];
                for (let row = BOARD_SIZE - 1; row >= 0; row--) {
                    const index = row * BOARD_SIZE + col;
                    if (newBoard[index] !== null) {
                        column.push(newBoard[index]);
                    }
                }
                
                // ë¹ˆ ê³µê°„ì„ ìƒˆë¡œìš´ ëœë¤ ë™ë¬¼ë¡œ ì±„ìš°ê¸°
                while (column.length < BOARD_SIZE) {
                    column.push(animals[Math.floor(Math.random() * animals.length)]);
                }
                
                // ì—´ì„ ë‹¤ì‹œ ë³´ë“œì— ë°°ì¹˜
                for (let row = 0; row < BOARD_SIZE; row++) {
                    const index = row * BOARD_SIZE + col;
                    newBoard[index] = column[BOARD_SIZE - 1 - row];
                }
            }
            
            return newBoard;
        }

        // ë§¤ì¹˜ ì²˜ë¦¬
        function processMatches() {
            const matches = findMatches();
            if (matches.length > 0) {
                // ë§¤ì¹˜ëœ íƒ€ì¼ì— ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì ìš©
                matchedTiles = matches;
                animatingTiles = matches;
                renderBoard();
                
                setTimeout(() => {
                    score += matches.length * 10;
                    document.getElementById('score').textContent = `ì ìˆ˜: ${score}`;
                    board = dropTiles(matches);
                    matchedTiles = [];
                    animatingTiles = [];
                    renderBoard();
                    
                    // ì—°ì‡„ ë§¤ì¹˜ë¥¼ ìœ„í•´ ë‹¤ì‹œ ì²´í¬
                    setTimeout(() => processMatches(), 300);
                }, 600); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„
            }
        }

        // íƒ€ì¼ í´ë¦­ ì²˜ë¦¬
        function handleTileClick(index) {
            if (isSwapping) return;
            
            if (selectedTiles.length === 0) {
                selectedTiles = [index];
                renderBoard();
            } else if (selectedTiles.length === 1) {
                const firstIndex = selectedTiles[0];
                if (firstIndex === index) {
                    selectedTiles = [];
                    renderBoard();
                    return;
                }
                
                // ì¸ì ‘í•œ íƒ€ì¼ì¸ì§€ í™•ì¸
                const firstRow = Math.floor(firstIndex / BOARD_SIZE);
                const firstCol = firstIndex % BOARD_SIZE;
                const secondRow = Math.floor(index / BOARD_SIZE);
                const secondCol = index % BOARD_SIZE;
                
                const isAdjacent = 
                    (Math.abs(firstRow - secondRow) === 1 && firstCol === secondCol) ||
                    (Math.abs(firstCol - secondCol) === 1 && firstRow === secondRow);
                
                if (isAdjacent) {
                    isSwapping = true;
                    
                    // íƒ€ì¼ êµí™˜
                    const newBoard = [...board];
                    [newBoard[firstIndex], newBoard[index]] = [newBoard[index], newBoard[firstIndex]];
                    
                    // êµí™˜ í›„ ë§¤ì¹˜ê°€ ìˆëŠ”ì§€ í™•ì¸
                    const originalBoard = [...board];
                    board = newBoard;
                    const matches = findMatches();
                    
                    if (matches.length > 0) {
                        renderBoard();
                        setTimeout(() => {
                            processMatches();
                            isSwapping = false;
                        }, 200);
                    } else {
                        // ë§¤ì¹˜ê°€ ì—†ìœ¼ë©´ ì›ë˜ëŒ€ë¡œ ë˜ëŒë¦¬ê¸°
                        board = originalBoard;
                        setTimeout(() => {
                            isSwapping = false;
                            renderBoard();
                        }, 200);
                    }
                }
                
                selectedTiles = [];
            }
        }

        // ê²Œì„ ë¦¬ì…‹
        function resetGame() {
            score = 0;
            document.getElementById('score').textContent = 'ì ìˆ˜: 0';
            selectedTiles = [];
            isSwapping = false;
            matchedTiles = [];
            animatingTiles = [];
            initializeBoard();
            
            // ì´ˆê¸° ë§¤ì¹˜ ì œê±°
            setTimeout(() => {
                processMatches();
            }, 500);
        }

        // ê²Œì„ ì‹œì‘
        window.addEventListener('load', () => {
            initializeBoard();
            // ì´ˆê¸° ë§¤ì¹˜ ì œê±°
            setTimeout(() => {
                processMatches();
            }, 500);
        });
    </script>
</body>
</html>